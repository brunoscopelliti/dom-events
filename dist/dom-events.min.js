/**
 * @fileoverview JavaScript DOM event handler micro library.
 * @copyright Bruno Scopelliti 2015
 * @author Bruno Scopelliti <me@brunoscopelliti.com>
 * @license MIT
 *
 * @module src/dom-events
 */
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function toArray_(a){return null==a?[]:isWindow_(a)||"undefined"==typeof a.length?[a]:Array.from(a)}function isWindow_(a){return a===window}function isEventObject_(a){return/Event]$/.test(Object.prototype.toString.call(a))}function contains_(a,b,c){if("string"==typeof b){var d=c?a:a.parentNode||document;return d.querySelectorAll(b).length>0}return(!c||a!==b)&&a.contains(b)}function loopProps_(a,b){var c=arguments.length<=2||void 0===arguments[2]?this:arguments[2];for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a)===!1)return!1;return!0}Object.defineProperty(exports,"__esModule",{value:!0});var match_=function(a){var b=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;return function(a,c){return isWindow_(a)?"window"==c:a==document?"document"==c:b.call(a,c)}}(document.body),Store=function(){function a(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1],c=u.get(a);return"undefined"==typeof c?[]:b?c[b]||[]:c}function b(a,b,c,d){var f=e(b,c,d);u.has(a)||u.set(a,{}),u.get(a)[f.type]||(u.get(a)[f.type]=[]);var g=u.get(a)[f.type].push(f);return 1==g&&j(a,f.type),f}function c(a,b,c,d){var e=u.get(a);if(e){var g={origType:b};c&&(g.delegator=c),"function"==typeof d&&(g.handler=d);var j=f(b,!0),l=new Set([b,j]);l.forEach(function(b){e[b]&&(e[b]=h(e[b],i.bind(null,g)),("undefined"==typeof e[b]||0==e[b].length)&&(delete e[b],k(a,b)))})}}function d(a,b,c){var d={currentTarget:a,data:c,isFired:!0,target:a,type:b},e=g(a);e.every(function(a){return d.currentTarget=a,l(d)})}function e(a,b,c){var d=++p,e=null!=b,g=f(a,e),h=Object.create(null);return h[q]=d,h.delegate=e,h.delegator=b,h.origType=a,h.type=g,h.handler=function(a){return c.apply(this,[a].concat(_toConsumableArray(a.data)))},c[q]?h.handler[q]=c[q]:c[q]=h.handler[q]=d,a!=g&&s[a]&&"function"==typeof s[a].decorator&&(h.handler=s[a].decorator(c,h)),h}function f(a){var b=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return b&&"undefined"!=typeof s[a]?s[a].delegateEvent:a}function g(a){var b=[];do b.push(a);while(a=a.parentNode);return b[b.length-1]===document&&b.push(window),b}function h(a,b){var c=this;return a.filter(function(a,d,e){return!b.call(c,a,d,e)})}function i(a,b){return loopProps_(a,function(a,c){return"function"==typeof a?b[c][q]===a[q]:b[c]===a})}function j(a,b){a.addEventListener(b,l,!1)}function k(a,b){a.removeEventListener(b,l,!1)}function l(a){if(!t){var b=m(a),c=Store.get(b.currentTarget,b.type);return n(b.target,b.currentTarget,function(a){return a.disabled&&"click"==b.type?void 0:(c.forEach(function(c){!c.delegate||c.delegate&&!contains_(a,c.delegator)||match_(a,c.delegator)&&o.call(b,c.handler,a)}),!b.isPropagationStopped)}),b.isPropagationStopped?!1:(b.currentTarget.disabled&&"click"==b.type||c.filter(function(a){return!a.delegate}).forEach(function(a){return o.call(b,a.handler)}),!b.isPropagationStopped)}}function m(a){var b=Object.create(r);return b.data=a.data||[],b.isFired=a.isFired||!1,b.currentTarget=a.currentTarget,b.relatedTarget=a.relatedTarget,b.target=a.target,b.type=a.type,isEventObject_(a)&&(b.originalEvent=a),b}function n(a,b,c){if("function"==typeof b){var d=[b,window];c=d[0],b=d[1]}var e=a,f=!0;do f=c.call(e,e);while(f!==!1&&e!=b&&(e=e.parentNode))}function o(a){var b=arguments.length<=1||void 0===arguments[1]?this.currentTarget:arguments[1];a.call(b,this)===!1&&(this.stopPropagation(),this.preventDefault()),this.isDefaultPrevented||this.isFired&&!isWindow_(b)&&"function"==typeof b[this.type]&&(t=!0,b[this.type](),t=!1)}var p=0,q=Symbol("EVStore_guid"),r=Object.create(null,{stopPropagation:{value:function(){this.isPropagationStopped=!0,this.originalEvent&&this.originalEvent.stopPropagation()}},preventDefault:{value:function(){this.isDefaultPrevented=!0,this.originalEvent&&this.originalEvent.preventDefault()}}}),s=function(){var a={};return loopProps_({mouseenter:"mouseover",mouseleave:"mouseout"},function(b,c){a[c]={delegateEvent:b,decorator:function(a,b){return function(c){var d=c.target,e=c.relatedTarget;return!match_(d,b.delegator)||e&&contains_(d,e,!0)?void 0:a.apply(d,[c].concat(_toConsumableArray(c.data)))}}}}),a}(),t=!1,u=new WeakMap;return{get:a,add:b,del:c,run:d}}(),DOMEvents={debug:Store.get,on:function(a,b,c,d){var e=toArray_(a);if("undefined"==typeof d){var f=[c,d];d=f[0],c=f[1]}e.forEach(function(a){Store.add(a,b,c,d)})},off:function(a,b,c,d){var e=toArray_(a);if("undefined"==typeof d&&"function"==typeof c){var f=[c,d];d=f[0],c=f[1]}e.forEach(function(a){var e=null==b?Object.keys(Store.get(a)):[b];e.forEach(function(b){return Store.del(a,b,c,d)})})},fire:function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;c>e;e++)d[e-2]=arguments[e];var f=toArray_(a);f.forEach(function(a){Store.run(a,b,d)})}};exports["default"]=DOMEvents,exports.EventsStore=Store;